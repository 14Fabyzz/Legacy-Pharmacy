<div class="page-container">
  <header class="page-header">
    <h2>PRODUCTOS EN ALMAC√âN</h2>
    <p>Gesti√≥n general del inventario, precios y estado de productos.</p>
  </header>

  <nav class="tabs-nav">
    <a routerLink="/app/productos/nuevo">NUEVO PRODUCTO</a>
    <a routerLink="/app/productos/almacen" routerLinkActive="active">PRODUCTOS EN ALMAC√âN</a>
  </nav>

  <div class="search-container">
     <input 
       type="text" 
       class="search-input" 
       placeholder="Buscar por nombre, c√≥digo, laboratorio..."
       [(ngModel)]="searchTerm">
   </div>

  <!-- Usamos el pipe async y search -->
  <ng-container *ngIf="products$ | async | search:searchTerm as filteredProducts">
    
    <div class="product-list-container">
      
      <div *ngFor="let product of filteredProducts" class="product-card">
        
        <!-- Imagen (Placeholder) -->
        <div class="product-image">
          <div class="image-placeholder">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/></svg>
          </div>
        </div>

        <!-- Informaci√≥n del Producto -->
        <div class="product-info-wrapper">
          <div class="product-header">
            <span class="product-id">ID: {{ product.id }}</span>
            <!-- CORREGIDO: nombre_comercial -->
            <h3 class="product-name">{{ product.nombre_comercial }}</h3>
            <!-- Badge de estado -->
            <span class="status-badge" [class.active]="product.estado === 'ACTIVO'">
              {{ product.estado }}
            </span>
          </div>

          <div class="product-details-grid">
            
            <div class="info-item">
              <dt>C√≥digo Interno:</dt>
              <!-- CORREGIDO: codigo_interno -->
              <dd>{{ product.codigo_interno }}</dd>
            </div>

            <div class="info-item">
              <dt>C√≥digo Barras:</dt>
              <!-- CORREGIDO: codigo_barras -->
              <dd>{{ product.codigo_barras || 'N/A' }}</dd>
            </div>
            
            <div class="info-item">
              <dt>Precio Venta:</dt>
              <!-- CORREGIDO: precio_venta_base -->
              <dd class="price-text">{{ product.precio_venta_base | currency }}</dd>
            </div>

            <div class="info-item">
              <dt>Laboratorio:</dt>
              <!-- CORREGIDO: laboratorio_nombre (si viene del mock) o laboratorio_id -->
              <dd>{{ product.laboratorio_nombre || product.laboratorio_id }}</dd>
            </div>

            <div class="info-item">
              <dt>Stock M√≠nimo:</dt>
              <!-- CORREGIDO: stock_minimo -->
              <dd>{{ product.stock_minimo }}</dd>
            </div>

            <div class="info-item">
              <dt>IVA:</dt>
              <!-- CORREGIDO: iva_porcentaje -->
              <dd>{{ product.iva_porcentaje }}%</dd>
            </div>

          </div>
        </div>

        <!-- Botones de Acci√≥n -->
        <div class="product-actions">
          <span>ACCIONES</span>
          <div class="action-icons">
            <a title="Ver Detalles">üëÅÔ∏è</a>
            <a title="Gestionar Imagen">üñºÔ∏è</a>
            <a title="Kardex / Movimientos">üìä</a>
            
            <!-- Enlace para editar usando el ID -->
            <a title="Editar Producto" [routerLink]="['/app/productos/editar', product.id]" class="btn-edit">
              ‚úèÔ∏è
            </a>
            
            <a title="Eliminar/Desactivar" class="btn-delete">üóëÔ∏è</a>
          </div>
        </div>

      </div> <!-- Fin product-card -->
    </div>

    <!-- Estado Vac√≠o -->
    <div class="no-results" *ngIf="filteredProducts.length === 0">
      <p>No se encontraron productos que coincidan con "{{ searchTerm }}"</p>
    </div>

  </ng-container>
</div>