<div class="page-container">
    <header class="page-header">
        <div class="header-content">
            <div>
                <h2>CENTRO DE ALERTAS E INVENTARIO</h2>
                <p>Gesti√≥n integral de vencimientos, stock cr√≠tico y alertas sanitarias.</p>
            </div>
        </div>
    </header>

    <!-- Navegaci√≥n Compartida -->
    <nav class="tabs-nav">
        <a routerLink="/app/productos/almacen" routerLinkActive="active">
            <span class="nav-icon">üì¶</span> ALMAC√âN
        </a>

        <a routerLink="/app/productos/consulta" routerLinkActive="active">
            <span class="nav-icon">üîç</span> CONSULTA
        </a>

        <a routerLink="/app/productos/vencimientos" routerLinkActive="active">
            <span class="nav-icon">üö®</span> MONITOR ALERTAS
        </a>

        <a routerLink="/app/productos/entrada-mercancia" routerLinkActive="active">
            <span class="nav-icon">üöö</span> ENTRADAS
        </a>

        <a routerLink="/app/productos/auditoria" routerLinkActive="active">
            <span class="nav-icon">üìã</span> AUDITOR√çA
        </a>

        <a routerLink="/app/productos/nuevo" routerLinkActive="active">
            <span class="nav-icon">‚ú®</span> NUEVO
        </a>
    </nav>

    <div class="dashboard-content" *ngIf="!loading">

        <!-- KPI CARDS SUMMARY -->
        <div class="kpi-grid">
            <!-- 1. Vencidos -->
            <div class="kpi-card critical" [class.active]="activeTab === 'critical'" (click)="setActiveTab('critical')">
                <div class="kpi-icon">üö®</div>
                <div class="kpi-info">
                    <span class="kpi-value">{{ expiredProducts.length }}</span>
                    <span class="kpi-label">Vencidos</span>
                </div>
            </div>

            <!-- 2. Por Vencer -->
            <div class="kpi-card warning" [class.active]="activeTab === 'alert'" (click)="setActiveTab('alert')">
                <div class="kpi-icon">‚ö†Ô∏è</div>
                <div class="kpi-info">
                    <span class="kpi-value">{{ soonExpiringProducts.length }}</span>
                    <span class="kpi-label">Por Vencer</span>
                </div>
            </div>

            <!-- 3. Stock Bajo (NUEVO) -->
            <div class="kpi-card lowstock" [class.active]="activeTab === 'lowstock'" (click)="setActiveTab('lowstock')">
                <div class="kpi-icon">üìâ</div>
                <div class="kpi-info">
                    <span class="kpi-value">{{ bajoStock.length }}</span>
                    <span class="kpi-label">Stock Bajo</span>
                </div>
            </div>

            <!-- 4. Seguros -->
            <div class="kpi-card healthy" [class.active]="activeTab === 'healthy'" (click)="setActiveTab('healthy')">
                <div class="kpi-icon">‚úÖ</div>
                <div class="kpi-info">
                    <span class="kpi-value">OK</span>
                    <span class="kpi-label">Saludables</span>
                </div>
            </div>
        </div>


        <!-- SECCI√ìN 1: VENCIDOS (CR√çTICO) -->
        <div class="expiration-section critical-section" *ngIf="activeTab === 'critical'">
            <div class="section-header">
                <h3>üö® Productos Vencidos</h3>
                <p>Retirar inmediatamente de estanter√≠a.</p>
            </div>

            <div class="table-card">
                <table class="expiration-table">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Lote / Ref</th>
                            <th>Fecha Vencimiento</th>
                            <th>Estado</th>
                            <th>Stock Actual</th>
                            <th class="text-right">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let p of expiredProducts">
                            <td>
                                <div class="product-info">
                                    <div class="product-icon-circle small">
                                        <img *ngIf="p.imagenUrl" [src]="p.imagenUrl" alt="img">
                                        <span *ngIf="!p.imagenUrl">üíä</span>
                                    </div>
                                    <div>
                                        <strong>{{ p.nombre_comercial }}</strong>
                                        <small>{{ p.concentracion }} - {{ p.laboratorio_nombre }}</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="ref-text">{{ p.codigo_interno }}</span>
                            </td>
                            <td class="date-cell">
                                {{ p.proximo_vencimiento | date:'dd/MM/yyyy' }}
                            </td>
                            <td>
                                <span class="status-tag expired">Vencido hace {{ (p.daysUntilExpiry || 0) * -1 }}
                                    d√≠as</span>
                            </td>
                            <td class="stock-cell">
                                <strong>{{ p.stock_actual }}</strong> unds
                            </td>
                            <td class="text-right">
                                <button class="btn-action danger">Dar de Baja</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="empty-tab" *ngIf="expiredProducts.length === 0">
                    <p>No hay productos vencidos. ¬°Excelente!</p>
                </div>
            </div>
        </div>

        <!-- SECCI√ìN 2: POR VENCER (ALERTA) -->
        <div class="expiration-section warning-section" *ngIf="activeTab === 'alert'">
            <div class="section-header">
                <h3>‚ö†Ô∏è Pr√≥ximos a Vencer (30 d√≠as)</h3>
                <p>Acciones recomendadas: Gesti√≥n de precio o promoci√≥n.</p>
            </div>

            <div class="table-card">
                <table class="expiration-table">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Lote / Ref</th>
                            <th>Fecha Vencimiento</th>
                            <th>D√≠as Restantes</th>
                            <th>Stock Actual</th>
                            <th class="text-right">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let p of soonExpiringProducts">
                            <td>
                                <div class="product-info">
                                    <div class="product-icon-circle small">
                                        <img *ngIf="p.imagenUrl" [src]="p.imagenUrl" alt="img">
                                        <span *ngIf="!p.imagenUrl">üíä</span>
                                    </div>
                                    <div>
                                        <strong>{{ p.nombre_comercial }}</strong>
                                        <small>{{ p.concentracion }} - {{ p.laboratorio_nombre }}</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="ref-text">{{ p.codigo_interno }}</span>
                            </td>
                            <td class="date-cell">
                                {{ p.proximo_vencimiento | date:'dd/MM/yyyy' }}
                            </td>
                            <td>
                                <span class="status-tag warning">{{ p.daysUntilExpiry }} d√≠as</span>
                            </td>
                            <td class="stock-cell">
                                <strong>{{ p.stock_actual }}</strong> unds
                            </td>
                            <td class="text-right">
                                <button class="btn-action promo">Promocionar</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="empty-tab" *ngIf="soonExpiringProducts.length === 0">
                    <p>No hay alertas de vencimiento pr√≥ximo.</p>
                </div>
            </div>
        </div>

        <!-- SECCI√ìN 3: STOCK BAJO (NUEVO) -->
        <div class="expiration-section lowstock-section" *ngIf="activeTab === 'lowstock'">
            <div class="section-header">
                <h3>üìâ Reposici√≥n de Inventario</h3>
                <p>Productos con stock por debajo del m√≠nimo permitido.</p>
            </div>

            <div class="cards-grid-view">
                <!-- Carta de Reabastecimiento -->
                <div class="restock-card" *ngFor="let p of bajoStock">
                    <div class="restock-icon">
                        üì¶
                    </div>
                    <div class="restock-info">
                        <h4>{{ p.nombre_comercial }}</h4>
                        <p class="sub-info">{{ p.concentracion }} - {{ p.laboratorio_nombre }}</p>
                        <div class="stock-metrics">
                            <span class="badge-min">Min: {{ p.stock_minimo }}</span>
                            <span class="stock-current-red">Actual: <strong>{{ p.stock_actual }}</strong></span>
                        </div>
                    </div>
                    <div class="restock-alert">
                        <span class="missing-text">Faltan {{ p.stockDiff }} un.</span>
                        <button class="btn-restock">Reabastecer</button>
                    </div>
                </div>
            </div>
            <div class="empty-tab" *ngIf="bajoStock.length === 0">
                <p>Todo el inventario tiene niveles √≥ptimos.</p>
            </div>
        </div>

        <!-- SECCI√ìN 4: HEALTHY (Solo Informativo) -->
        <div class="expiration-section healthy-section" *ngIf="activeTab === 'healthy'">
            <div class="empty-state">
                <div class="empty-icon">‚úÖ</div>
                <h3>Sistema Saludable</h3>
                <p>Selecciona una alerta arriba para ver detalles si existen.</p>
            </div>
        </div>

    </div>
</div>